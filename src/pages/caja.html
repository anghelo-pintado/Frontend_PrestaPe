<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti√≥n de Caja - PrestaPe</title>
    <link rel="stylesheet" href="../css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
  </head>
  <body>
    <header class="navbar">
      <div class="navbar-brand">
        <i class="fa-solid fa-landmark"></i>
        <h1>PrestaPe</h1>
      </div>
      <nav class="navbar-nav">
        <a href="principal.html" class="nav-link">
          <i class="fa-solid fa-house"></i> Inicio
        </a>
        <a href="prestamos.html" class="nav-link">
          <i class="fa-solid fa-table-list"></i> Pr√©stamos
        </a>
        <a href="nuevo-prestamo.html" class="nav-link">
          <i class="fa-solid fa-circle-plus"></i> Nuevo Pr√©stamo
        </a>
        <a href="caja.html" class="nav-link active">
          <i class="fa-solid fa-cash-register"></i> Caja
        </a>
        <a href="perfil.html" class="nav-link">
          <i class="fas fa-user"></i> Perfil
        </a>
        <a href="#" id="logout-btn" class="nav-link"
          ><i class="fa-solid fa-right-from-bracket"></i> Salir</a
        >
      </nav>
    </header>

    <main class="container">
      <div class="main-title">
        <h2>Control de Caja</h2>
      </div>

      <section id="panel-caja-cerrada" class="card text-center hidden">
        <div class="empty-state">
          <i class="fa-solid fa-store-slash fa-4x text-muted"></i>
          <h3 class="mt-3">La caja est√° cerrada</h3>
          <p class="text-muted">Debe iniciar turno para registrar pagos.</p>

          <div class="form-group mt-4" style="max-width: 300px; margin: 0 auto">
            <label>Saldo Inicial (Dinero en caj√≥n)</label>
            <div class="input-group">
              <span class="input-group-text">S/</span>
              <input
                type="number"
                id="input-saldo-inicial"
                class="form-control text-center"
                value="0.00"
                min="0"
                step="0.10"
              />
            </div>
          </div>

          <button class="btn btn-primary mt-3" onclick="abrirCaja()">
            <i class="fa-solid fa-key"></i> Abrir Caja
          </button>
        </div>
      </section>

      <section id="panel-caja-abierta" class="hidden">
        <div class="dashboard-grid">
          <div class="card info-card">
            <!-- Header -->
            <div class="card-header-row">
              <h4><i class="fa-solid fa-shop"></i> Turno Activo</h4>
              <span class="badge badge-success">ABIERTA</span>
            </div>

            <!-- Datos iniciales -->
            <div class="info-item mt-3">
              <span>Apertura:</span>
              <strong id="lbl-fecha-apertura">--:--</strong>
            </div>

            <div class="info-item">
              <span>Saldo Inicial:</span>
              <strong id="lbl-saldo-inicial">S/ 0.00</strong>
            </div>

            <hr />

            <!-- Ingresos -->
            <h5 class="text-muted">Ingresos Registrados (Sistema)</h5>

            <div class="info-item">
              <span>Efectivo (+ Redondeo):</span>
              <strong id="lbl-ingreso-efectivo" class="text-success"
                >S/ 0.00</strong
              >
            </div>

            <div class="info-item">
              <span>Digital (Yape/Tarjeta):</span>
              <strong id="lbl-ingreso-digital" class="text-info"
                >S/ 0.00</strong
              >
            </div>

            <hr />

            <!-- Total esperado -->
            <div class="info-item total-esperado-box">
              <span><strong>üí∞ TOTAL ESPERADO EN CAJA:</strong></span>
              <strong
                id="lbl-total-esperado"
                class="text-success total-esperado-text"
              >
                S/ 0.00
              </strong>
            </div>

            <small class="text-muted">
              Este es el monto que debe coincidir con su conteo f√≠sico de
              efectivo.
            </small>
          </div>

          <div class="card action-card">
            <h4><i class="fa-solid fa-sack-dollar"></i> Arqueo y Cierre</h4>
            <p class="text-sm text-muted mb-3">
              Ingrese la cantidad de billetes y monedas que tiene f√≠sicamente.
              El sistema validar√° que coincida con lo registrado.
            </p>

            <div class="alert alert-warning">
              <strong
                ><i class="fa-solid fa-triangle-exclamation"></i>
                Importante:</strong
              >
              Solo cuente el dinero en <strong>EFECTIVO</strong>. No sume
              vouchers de Yape ni Tarjetas.
            </div>

            <div class="form-group mt-3">
              <label for="input-monto-fisico" class="font-bold"
                >Total Efectivo en Caj√≥n (S/)</label
              >
              <input
                type="number"
                id="input-monto-fisico"
                class="form-control input-lg"
                placeholder="0.00"
                step="0.01"
              />
              <small class="text-muted"
                >Debe coincidir con: Saldo Inicial + Ventas Efectivo</small
              >
            </div>

            <div class="form-group mt-3">
              <label for="input-observaciones"
                >Observaciones / Justificaci√≥n</label
              >
              <textarea
                id="input-observaciones"
                class="form-control"
                rows="2"
                placeholder="Ej: Faltan 0.10 c√©ntimos por redondeo..."
              ></textarea>
            </div>

            <button
              class="btn btn-danger btn-full-width mt-4"
              onclick="procesarCierre()"
            >
              <i class="fa-solid fa-lock"></i> Cuadrar y Cerrar Caja
            </button>
          </div>
        </div>
      </section>
    </main>

    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/caja-logic.js"></script>
    <script>
      if (window.SisPrestaAuth) window.SisPrestaAuth.checkAuthAndRedirect();
    </script>
  </body>
</html>
